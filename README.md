# LOVE20 行动扩展协议之 LP 扩展协议

## 0. 关于协议

此扩展协议基于 LOVE20 扩展协议标准，扩展行动参与机制，允许以 LP 参与行动并获得铸币激励。

## 1. 核心优势

### 1.1 公平分配

自动计算激励分配，无需人工参与计算与验证。

### 1.2 防止闪电贷攻击

无法在同一区块内完成质押、获取激励并取回质押资产，可从根本上杜绝闪电贷攻击。

### 1.3 长期主义激励机制

与治理票绑定，将参与资格与激励大小与治理票占比挂钩，只有长期主义者才能获得更多激励。

## 2. 初始参数

### 2.1 最小治理票占比

加入行动时，行动者的治理票占比（有效治理票数/总治理票数，精度 1e18）不得低于最小治理票占比。

### 2.2 LP 代币地址

LP 代币合约地址。

### 2.3 治理票占比倍数

在计算分数时，治理票占比会乘以治理票占比倍数，用于调整治理票在分数计算中的权重。当治理票占比倍数为 0 时，治理票不参与激励计算，激励仅由有效 LP 代币占比决定。

## 3. 行动者

### 3.1 加入行动

行动者使用 LP 代币加入行动，通过验证后可获得铸币激励。

参与条件：

- 首次参与：治理票占比不得低于最小治理票占比
- 参与数量必须大于 0

### 3.2 退出行动

距离最后一次参与超过 1 个区块后，随时退出行动并取回参与 LP 代币。退出后，当轮将无法获得激励。

### 3.3 铸造激励

行动者可以在验证阶段完成后，铸造行动激励，溢出激励将同步销毁。

激励根据以下公式分配：

```
当治理票占比倍数 > 0 时：
  实际激励 = 行动总激励 x MIN(有效 LP 代币占比, 治理票占比 * 治理票占比倍数)
  溢出激励 = 行动总激励 x 有效 LP 代币占比 - 实际激励

当治理票占比倍数 = 0 时：
  实际激励 = 行动总激励 x 有效 LP 代币占比
```

其中：

- 有效 LP 代币数量 = 参与 LP 代币数量 - 当轮扣除量
- 总有效 LP 代币数量 = 总参与 LP 代币数量 - 当轮总扣除量
- 有效 LP 代币占比 = 有效 LP 代币数量 / 总有效 LP 代币数量
- 当轮扣除量 = 当轮各次加入的 (加入数量 x 已过区块数 / 阶段总区块数) 之和；延续上轮 LP 不产生扣除量
- 当轮总扣除量 = 所有行动者当轮扣除量之和
- 治理票占比 = 有效治理票数 / 总治理票数（取铸造时的值）
- 退出轮次不计算激励

## 4. 示例行动：LOVE20/TUSDT 流动性激励

### 🌱 行动理念 🌱

为了让更多小伙伴能够方便快捷地使用 TUSDT 兑换 LOVE20，特倡议发起此行动。

### 🎯 参与要求 🎯

1. 在治理页做流动性质押，持有治理票（且治理票占比不低于 0.03%）
2. 在兑换页添加 LOVE20/TUSDT 流动性获得 LP 代币后，**将 LP 代币参与进本行动**（在行动页加入行动、放入 LP）

### ⭐ 激励如何分配 ⭐

实际激励 = 行动总激励 × MIN（有效 LP 代币占比，治理票占比 × 2）。其中治理票占比取**铸造时**的值。

有效 LP 代币占比 = 你在本行动中的有效 LP 数量 / 本行动总有效 LP 数量（有效 LP = 参与数量 − 当轮扣除量）。

**当轮扣除量** = 当轮各次加入的「加入数量 × 已过区块数 / 阶段总区块数」之和；延续上轮的 LP 不产生扣除。其中「已过区块数」指**该次加入时**、本阶段内已经过去的区块数。

例如：阶段总区块数 1000。某地址当轮在阶段内第 200 个区块时加入 1000 LP（该次加入时阶段已过去 200 区块），则 已过区块数 = 200，当轮扣除量 = 1000 × 200/1000 = 200，有效 LP = 1000 − 200 = 800。若当轮还在阶段内第 600 个区块时追加 500 LP（该次加入时阶段已过去 600 区块），则追加部分 已过区块数 = 600，扣除 = 500 × 600/1000 = 300，当轮扣除量合计 = 200 + 300 = 500，有效 LP = 1000 + 500 − (200 + 300) = 1000。

溢出激励 = 行动总激励 × 有效 LP 代币占比 − 实际激励，**溢出激励同步销毁**。

例如：某地址铸造时治理票占比为 3%（两倍为 6%），当轮有效 LP 代币占比为 3.5%，取 6% 和 3.5% 的最小值 3.5%，则其实际激励 = 行动总激励 × 3.5%，溢出激励 = 0（无销毁）。若该地址有效 LP 代币占比为 10%（大于 6%），则实际激励 = 行动总激励 × 6%，溢出激励 = 行动总激励 × (10% − 6%) = 行动总激励 × 4%，该 4% 部分同步销毁。**销毁量并非一成不变**：在铸造前若补足治理票、使治理票占比×2 不低于有效 LP 占比，则可减少甚至消除溢出激励，从而降低销毁量、提高实际铸币量。
